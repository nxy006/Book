# 第04章 对象、变量和常量
---

[TOC]

## 4.1 对象
在 Ruby 中，表现数据基本单位称为**对象**（object）
我们介绍一些常用的对象：
- **数值对象**：1、-10、3.14 等是表示数字的对象，另外还有表示矩阵、复数、质数、公式的对象
- **字符串对象**：“你好”、”hello“ 等表示字符串序列的对象
- **数组对象、散列对象**：表示多个数据的集合的对象
- **正则表达式对象**：表示匹配模式的对象
- **时间对象**：比如“2018年8月25日早上9点” 等表示时间的对象
- **文件对象**：一般可以理解为表示文件本身的对象，但确切而言是对文件进行读写操作的对象
- **符号对象**：表示用于识别方法等名称的标签的对象。

除此之外，Ruby 还有范围对象（ragne）、异常对象（exception）等。

## 4.2 类
Ruby 的类（class）表示的就是对象的种类，对象拥有什么特性都是由类决定的。我们介绍过的对象以及所属类如下所示：

|       对象      |        类      |
| --------------- | ------------- |
|       数值      | `Numeric` |
|     字符串    |  `String`    |
|       数组      |  `Array`    |
|       散列      |  `Hash`    |
| 正则表达式 | `Regexp`  |
|       文件      |     `File`    |
|       符号      | `Symbol`  |

> 注： “××类的对象”，我们也一般说成 “××类的实例（instance）”，在Ruby中所有对象其实都是某个类的实例，因此Ruby中的对象和实例的意义几乎是一样的。我们在强调某个对象属于某个类时经常使用“实例”来代替“对象”。

上表中的类都是 Ruby 默认提供的，我们可以按照实际情况自定义类，相关内容详见第8章
<br/>

## 4.3 变量
Ruby 中有四种类型的变量，命名方式决定了其种类：
- 局部变量（local variable）：以英文小写字母或者 `_` 开头
- 全局变量（global variable）：以 `$` 开头
- 实例变量（instance variable）： 以 `@` 开头
- 类变量（class variable）：以 `@@` 开头

除以上四种之外，还有一种名为**伪变量**（pseduo variable）的特殊变量，值Ruby预定义的代表某种特定值的特殊变量，因此即使我们赋值给它们也不会实际改变它的值，Ruby中 `nil`、`true`、`false`、`self`等都是伪变量。

### 局部变量与全局变量
局部是指变量在程序中的有效范围（也称变量的作用域）是局部的，在不同位置使用名称相同的局部变量，对应的是不同的变量；
全局是指变量在程序中的有效范围是全局的，在不同位置使用名称相同的全局变量，都对应的是同一个变量。

一般我们不推荐使用全局变量，全局变量在程序的任何地方都可以修改，因此在规模较大的程序中使用会增加程序不必要的复杂度。程序首次为局部变量赋值时局部变量会被初始化，使用了未初始化的变量，程序会发生错误。

实例变量和类变量是在定义类时使用的变量，我们在第8章说明。

## 4.4 常量
**常量**（constant）的作用和变量一样，是某个对象的“名片”，但它不能被赋值。对于程序中多次引用且固定不变的值，我们会用常量来定义。
常量以大写的英文字母开头，Ruby 预定义了一些常量。

## 4.5 保留字
下表中的单词在程序中作为名称使用时会受到限制，我们称之为**保留字**，使用这些单词作为变量名会导致语法错误。

| 保留字 | - | - | - | - |
| -- | -- | -- | -- | -- |
| `__LINT__` | `__ENCODING__` | `__FILE__` | `BEGIN` | `END` |
| `alias` | `and` | `begin` | `break` | `case` |
| `class` | `def` | `defined?` | `do` | `else` |
| `elseif` | `end` | `ensure` | `false` | `for` |
| `if` | `in` | `module` | `next` | `nil` |
| `not` | `or` | `redo` | `rescue` | `retry` |
| `return` | `self` | `super` | `then` | `true` |
| `undef` | `unless` | `until` | `when` | `while` |
| `yield` | `` | `` | `` | `` |

## 4.6 多重赋值
我们已经介绍过“变量=值”这样的赋值方法，Ruby还提供了只用一个表达式为对个变量赋值的方法，即**多重赋值**。

### 4.6.1 合并执行多个赋值操作
当我们希望对一组变量同时赋值，可以简写如下：
```ruby
a, b, c = 1, 2, 3
```

另外，变量前加上 `*`，表示 Ruby 会将未分配的值封装为数组赋值给变量，例如：
```ruby
a, b, *c = 1, 2, 3, 4, 5
p [a, b, c]                #=> [1, 2, [3, 4, 5]]
a, *b, c = 1, 2, 3, 4, 5
p [a, b, c]                #=> [1, [2, 3, 4], 5]
```

### 4.6.2 交换变量的值
通常，交换变量的值我们需要一个临时变量保存保留的值，进行多次赋值，Ruby 中使用多重赋值可以一行程序完成：
```ruby
a, b = 0, 1
a, b = b, a
p [a, b]       #=> [1, 0]
```

### 4.6.3 获取数组的元素
用数组赋值时，如果左边有多个变量，Ruby 会自动获取数组的元素进行多重赋值。
```ruby
ary = [1, 2]
a, b = ary
p a      #=> 1
p b      #=> 2
```

只是希望获取数组开头的元素时，可以像下面这样做。但这种写法会给人 “是不是没写完？” 的感觉，建议尽量少用这种写法。
```ruby
ary = [1, 2]
a, = ary
p a      #=> 1
```

### 专栏：变量的命名方法
以变量名的开头决定变量的种类，是 Ruby 中对变量命名唯一要遵守的底线，但实践中也存在一些非强制性的、约定的命名规则：

- **使用简明易懂的单词**：不要使用生僻的单词，有时使用拼音命名也是不错的选择，团队开发约定命名范围非常重要
- **不要过多使用省略的名称**：清晰的名称能够更容易地阅读程序
- **对个多个单词组合的命名，使用 `_` 隔开各个单词，或者单词以大写字母开头**：一般来讲，Ruby 中变量和方法名使用前者，类名和模块名使用后者。
