# 第06章 循环
---

[TOC]

## 6.1 循环的基础
我们在程序中会需要用到循环结构实现功能，Ruby 提供了基本的循环结构。
> 特殊的是，Ruby 还可以用方法来实现循环，我们将在第 11 章详细说明。

## 6.2 循环时的注意事项
循环时必须注意两点：
- 循环做什么
- 停止循环的条件是什么

## 6.3 实现循环的方法
Ruby 中有两种实现循环的方法：
- 使用循环语句
- 使用方法实现循环

## 6.4 times 方法
如果只是单纯地执行一定次数的处理，用 times 方法可以很轻松的实现。
```ruby
循环次数.times do
  希望循环的处理
end
```
其中 `do ~ end` 部分可以用 `{ ~ }` 代替。

还可以获知块中当前的循环次数（从0开始）：
```ruby
循环次数.times do | 循环变量 |
  希望循环的处理
end
```

## 6.5 for 语句
for 语句同样是用于实现循环的，但与 times 不同的是，for 并不是方法，而是 Ruby 提供的循环控制语句。（do 可以省略）
```ruby
for 变量 in 开始数值..结束数值 do
  希望循环的处理
end
```

## 6.6 普通的 for 语句
其实上一节介绍的是 for 语句的特殊用法，普通的 for 语句用法如下所示：（do 可以省略）
```ruby
for 变量 in 对象 do
  希望循环的处理
end
```

这里的对象，可以是数组等类型，上一节中 `..` 或 `...` 都是创建范围对象时所需要的符号。

## 6.7 whlie 语句
while 语句可以适应任意类型的循环，其语法如下：（do 可以省略）
```ruby
while 条件 do
  希望循环的处理
end
```

只要 for 语句能够实现的循环，就没必要改写为 while 语句，但在某些情况下 while 语句会更容易理解。

## 6.8 until 语句
与 if 和 unless 相似，while 语句也有对应的相反语句，即 until 语句，until 语句在条件为假时会循环，直到条件为真为止：
```ruby
until 条件 do
  希望循环的处理
end
```

## 6.9 each 方法
each 方法将对象集合中的对象逐个取出，这与 for 语句类型，我们可以简单地改写 for 语句：（ `do ~ end` 部分可以用 `{ ~ }` 代替。）
```ruby
对象.each do | 变量 |
  希望循环的处理
end
```

在 Ruby 内部，for 语句是通过 each 方法实现的，因此可以使用 each 的对象，同样可以指定为 for 语句的循环对象。

## 6.10 loop 方法
还有一种情况是没有终止条件的条件，只是不断执行循环处理：
```ruby
loop do
  希望执行的处理
end
```

在实际使用 loop 方法时，我们需要用到下面的 break 强行终止循环。

## 6.11 循环控制
Ruby 提供了如下三种控制循环命令，用以终止或跳转循环：

| 命令 | 用途 |
| ------ | ------ |
| `break` | 终止程序，跳出循环 |
| `next`   | 跳到下一次循环 |
| `redo`   | 在相同的条件下重复刚才的处理 |

### 6.11.1 break
break 会终止全体程序，跳出循环。

### 6.11.2 next
next 会忽略 next 后面的部分，开始下一次循环。

## 6.12 小结
本章介绍了循环时所用的语句和方法，在实现功能的基础上，活用不同的语句能够让程序更便于读写、容易理解。

| 类型 | 主要用途 |
| ------ | ------------ |
| times 方法 | 确定了循环次数时使用 |
| for 语句 | 从对象中取出元素时使用（each语法糖） |
| while 语句 | 希望自由指定循环条件时使用 |
| until | 使用 while 语句使循环条件变得难懂时使用 |
| each 方法 | 从对象中取出元素时使用 |
| loop 方法 | 不限制循环次数时使用 |

> **语法糖**：语法糖是一种为了照顾一般人的习惯而产生的特殊语法，它并不会加强语言的任何功能，但对于提高程序的易读性来讲是不可或缺的。

### 专栏：do ~ end 与 { ~ }
在介绍 times 方法时，我们介绍了块的两种写法，即 `do ~ end` 与 `{ ~ }` 写法，从效果来看，两种方法没有太大区别，但我们一般约定如下编码规则：
- 跨行写程序时使用 `do ~ end`
- 程序写在一行时用  `{ ~ }`
