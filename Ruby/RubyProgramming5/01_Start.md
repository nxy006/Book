# 第01章 Ruby初探
---

[TOC]

## 1.1 Ruby 的运行方法
Ruby程序有多种执行方法，其中最常见的是使用 `ruby` 命令执行，其次是使用 `irb` 命令，以交互式命令行方式执行。

### 1.1.1 ruby 命令的执行方法
```ruby
print("Hello, Ruby.\n")
```
在编辑器写入上述内容，将文件名修改为 `helloruyb.rb`，保存文件。接下来在命令行就可以使用 `ruby helloruby.rb` 命令执行程序。
执行后会在控制台输出 `Hello, Ruby.` 并换行。

### 1.1.2 irb 命令的执行方法
与ruby命令一样，irb命令也在控制台执行，但不需要指定程序文件。
执行irb命令后，就会出现命令提示符（类似：`irb(main):001:0> `），在这里将上面的代码输入并回车，即可执行程序。像这样在控制台执行的程序可以马上执行，这对进行简单的测试非常方便。在控制台输入 `exit` 或使用 Ctrl + D 可以终止 `irb` 命令。

> 1.使用 Ruby Instarller for Windows 安装的 Ruby，在执行 irb 命令可能提示 `DL is deprecated, please use Fiddle` 警告，这是因为使用的 readline 库引用了旧版 DL 库，对使用没有影响。
>  
> 2.在 Mac 或 Windows 下 irb 命令可能无法正确输入中文，这时可以使用 `irb --noreadline` 选项，这样就可以正常输入中文，但因为关闭了 readline 功能，在控制台编辑已经输入的字符、查看输入历史记录等功能将无法使用。

<br/>

## 1.2 程序解说
```ruby
print("Hello, Ruby.\n")
```

### 1.2.1 对象
`"Hello, Ruby.\n"`这部分被称为 String对象或字符串对象，是一个代表字符串 Hello, Ruby 的对象。
字符串、数值、时间等各种数据，在ruby中都是对象。

### 1.2.2 方法
`print` 是一个 **方法**，所谓方法就是对象的欣慰。数值的加减法、字符串合并等都是通过执行方法实现的。`print` 方法的作用是输出 `()` 里的内容，因此在执行程序后控制台显示了字符串对象 `Hello, Ruby`。我们把执行方法时所必需的条件称为 **参数**。
<br/>

## 1.3 字符串
上文程序中的 `\n` 是换行符，利用换行符可以用普通的字符达到换行的目的。输出如下内容有两种写法：
```
Hello,
Ruby
!
```

一种写法是在代码中输入换行：
```ruby
print("
Hello,
Ruby
!
")
```

另一种方法是采用了换行符 `\n` 的写法，这种写法更加具有可读性：
```ruby
print("Hello,\nRuby\n!\n")
```

除了`\n`以外，ruby还提供了其他几种写法，比如使用`\"`表示`"`，使用`\\`表示`\`。
像这样程序对字符串中 \ 后面字符特殊处理的过程叫做 **转义**，`\`称为转义字符。

### 1.3.2 `' '`与 `" "`
创建字符串对象除了可以使用双引号，还可以使用单引号。在单引号里，像 `\n` 这样的字符将不会生效，内容会原样输出。但也有例外，需要输入 `\` 或 `'` 时候还是需要加入 `\` 转义。
<br/>

## 1.4 方法的调用
关于方法，Ruby在调用方法时候可以省略 `()`，如果需要多个参数可以用逗号 `,` 分隔。
<br/>

## 1.5 `puts` 方法
`puts` 方法与 `print` 方法稍有区别，`puts`方法在输出结果的末尾一定会输出换行符。
<br/>

## 1.6 `p` 方法
`p` 方法可以输出对象的内容，如下所示：
```ruby
puts "100" #=> 100
puts 100   #=> 100
p "100"    #=> "100"
p 100      #=> 100
```
`puts`对`"100"`和 `100` 的输出完全相同，因此无法区分对象类型，而`p`方法可以采用不同的形式输出。
另外，使用 `p` 方法时，换行符、制表符等特殊字符不会被转义，会直接输出原文。
> TODO：那么输出 `\\` 或 `\'` 会原样输出吗，也就是说，与使用单引号`' '`有无区别？

如果只是需要程序执行结果，可以使用 `print` 方法，如果需要确认程序执行情况，则可以使用 `p` 方法，原则上 `p` 方法是提供给编程者使用的。

## 1.7 中文的输出
输出中文只需要在字符串中使用中文即可，不过，编码设定也可能导致错误。

> **使用中文的注意事项**
> 在某些情况下使用中文脚本可能出现如下错误 `invalid multibyte char (UTF-8)`
> 这是编写程序时没有指定编码方式造成的，Ruby程序的编码方式，可以通过在程序首行添加注释 `#encoding: <编码方式>` 来指定，我们称这个注释为 **魔法注释**（magic comment）。（例如使用GBK编码时，可使用 `#encoding: GBK`），这样ruby就可以正确识别文件中的中文了。如果没有指定魔法注释，ruby会默认使用 UTF-8 编码方式。
> 此外，使用 p 方法输出时有时也会出现乱码，可以使用 `-E <编码方式>` 选项指定输出的编码方式。

## 1.8 数值表示与计算
讲解了数值之后，我们再来看看 Ruby 是怎么处理数值的。

### 1.8.1 数值
Ruby 数值的表示方法很简单，直接输入即可。例如 `1`表示 1 的整数（Fixnum）对象， `3.1415` 表示 3.1415 的浮点数（Float）对象。
数值的输出同样可以使用 `print` 和 `puts` 方法

### 1.8.2 四则运算
Ruby还可以使用四则运算，分别使用 `+-*/` 表示加减乘除，并具有先乘除后加减的优先级判断能力。

## 1.9 变量
变量是程序中不可缺少的元素之一，可以将其理解为给对象贴上的标签。我们可以像这样使用变量：`<变量名> = <对象>`，这个过程称为将对象赋值给变量。
若不使用变量，修改程序将需要修改所有有关代码，在复杂的程序中较为困难。另外，变量还可以清晰表示某个值的含义，因此为变量命名非常重要。

### print 方法和变量
`print "表面积= ", area, "\n"` 表示一个带有三个参数的print方法。

这个方法也可以如下这样书写：`print "表面积= #{area}\n"`，`#{ }` 这样的写法表示把 `area` 的值签入到字符串，得到的输出结果是一样的。

另外，输出时候常常会输出换行符，因此采用 `puts` 方法会更加简洁：`puts "表面积= #{area}"`

## 1.10 注释
程序中可以添加注释，注释不会影响程序的执行。若希望记录如下内容时，就需要用到注释：
- 程序的名称、作者、发布条件等信息
- 程序说明

Ruby 用 `#` 表示注释（单行注释）的开始，一行中从 `#` 开始的地方都是注释。
另外，用 `=begin`和`=end`括起来的部分也是注释（多行注释），在文件开头结尾或内容较长的时候经常使用这种写法。

除此之外，注释还有使得某行代码暂时不执行的作用。Ruby没有使一行的某部分代码称为注释的写法（例如C语言的`/* */`注释）。

## 1.11 控制语句
编程语言中都有控制语句，控制语句能让程序在某种情况下改变执行顺序或只执行某一部分。
控制语句分为：
- **顺序控制**：按照程序顺序依次执行
- **条件控制**：若某条件成立，则执行 A，否则执行 B
- **循环控制**：在条件成立之前，反复执行 A
- **异常控制**：在发生某种异常时，执行 A

## 1.12 条件判断 `if ~ then ~ end`
if 语句可以用于根据条件变化改变程序的行为，语法如下：（其中 else 子句如不需要可以省略）
```ruby
if <提交> then
  条件成立时的操作
else
  条件不成立时的操作
end
```
条件一般是指能返回 `true` 或 `false` 的表达式，例如比较两个值。
Ruby 使用 `== != >= <=` 等条件运算符表示等于，不等于、大于等于、小于等于等判断。

## 1.13 循环
有时我们会遇到需要希望多次执行相同处理的情况，这时可以使用循环。

### 1.13.1 while 语句
while 语句是执行循环时用到的一种基本语句。`do` 关键字可以省略
```ruby
while <循环条件> do
  希望循环的处理
end
```

## 1.13.2 times 方法
循环处理的次数如果已经确定，使用 `times` 方法会更加简单：
```ruby
<循环次数>.times do
  希望循环的处理
end
```

`times` 方法被称为迭代器（iterator），是Ruby的一个特色功能。从拼写即可看出，迭代器表示的是循环（iterate）的容器（-or），是指用于执行循环处理的方法。
Ruby 除了 times 方法外，还提供了很多迭代器，典型的有 `each` 方法，相关内容将在第2章中讲解。
